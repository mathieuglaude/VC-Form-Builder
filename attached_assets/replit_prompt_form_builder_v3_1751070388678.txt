
**Prompt for Replit AI (Ghostwriter) â†’ Form Builder w/ VC Autofill & Credential Library (SDKâ€‘only variant)**  
*Drop this whole file into Replit Ghostwriter.*

---

## 0Â Â·Â Context

Weâ€™re building a **frontâ€‘endâ€“only** Form.io SDK integration (no standalone Form.io server).  
Backâ€‘end = Express + Mongo for:

* Form configs + perâ€‘form metadata (name, slug, purpose, logo)
* Credential library (reâ€‘usable credential templates)
* VC proof requests & websocket notifications

The HomeÂ Dashboard, Builder, Preview pages, and VC autofill logic from **promptÂ v2** remain unchanged.  
This prompt **adds** a **Credential Library** feature and seeds it with two BCÂ Government credentials.

---

## 1Â Â·Â Credential Library â€” User Stories

| Role | Story |
|------|-------|
| **Admin** | I visit **/credentials** and see a list of credential templates (name, version, issuer, last updated). |
|          | I can click **Add Credential** to create a new template by pasting: *Name*, *SchemaÂ ID / URL*, *CredÂ DefÂ ID*, *IssuerÂ DID*, and an attribute list. |
|          | From the **Form Builder**, when editing a component that is tagged **VerifiedÂ Attribute**, I can open a dropdown of library credentials, then a second dropdown of attributes from that credential. |
| **System** | On first run, the library already contains:<br/>â€¢ **BC DigitalÂ BusinessÂ CardÂ v1**<br/>â€¢ **BC PersonÂ CredentialÂ v1** |

---

## 2Â Â·Â Data Model Additions

```ts
// backend/src/models/CredentialTemplate.ts
interface AttributeDef { name: string; description?: string }
interface CredentialTemplateDoc extends Document {
  label: string;               // e.g. "BC Digital Business Card v1"
  version: string;             // "1.0"
  schemaId: string;            // Indy / JSON Schema ID
  credDefId: string;           // Indy credential definition ID
  issuerDid: string;           // DID that issues the credential
  schemaUrl?: string;          // link to CANDY / spec page
  attributes: AttributeDef[];
  createdAt: Date;
  updatedAt: Date;
}
```

> ğŸ¯ **Index** on `label` (unique).

---

## 3Â Â·Â API Routes

| Method | Path | Purpose |
|--------|------|---------|
| `GET`  | `/api/cred-lib` | List credential templates |
| `POST` | `/api/cred-lib` | Create template (Admin only) |
| `PUT`  | `/api/cred-lib/:id` | Update template |
| `DELETE`| `/api/cred-lib/:id` | Remove template |

(Use simple token auth or leave unprotected for PoC.)

---

## 4Â Â·Â Frontend Additions

```
frontend/src/pages/
â”œâ”€ CredentialsPage.tsx      // route /credentials
frontend/src/components/
â”œâ”€ CredentialCard.tsx
â””â”€ CredentialModal.tsx      // add/edit dialog
```

### 4.1 CredentialsPage

* Grid list of `<CredentialCard />`.
* â€œAddâ€¯Credentialâ€ button opens **CredentialModal** (Formik + zod validation).
* Uses **SWR** to hit `/api/cred-lib`.

### 4.2 Builder Integration

Augment the **VerifiedÂ Attribute** property panel:

1. **Credential** `<select>` â†’ options from `/api/cred-lib`.
2. **Attribute** `<select>` â†’ populated by chosen credentialâ€™s `attributes[]`.

Persist selection as:

```jsonc
{
  "dataSource": "vc",
  "vc": {
    "templateId": "<mongo_id>",
    "attribute": "businessLegalName"
  }
}
```

---

## 5Â Â·Â Seed Script

`backend/src/seedCredentials.ts`

```ts
import CredentialTemplate from './models/CredentialTemplate';

await CredentialTemplate.deleteMany({}); // idempotent seed

await CredentialTemplate.insertMany([
  {
    label: 'BC Digital Business Card v1',
    version: '1.0',
    schemaId: 'M6M4nâ€¦:2:DigitalBusinessCard:1.0',
    credDefId: 'M6M4nâ€¦:3:CL:12345:tag',
    issuerDid: 'did:sov:M6M4nâ€¦',
    schemaUrl: 'https://bcgov.github.io/digital-trust-toolkit/docs/governance/business/digital-business-card-v1/',
    attributes: [
      { name: 'business_legal_name' },
      { name: 'business_number' },
      { name: 'incorporation_number' },
      { name: 'jurisdiction' }
    ]
  },
  {
    label: 'BC Person Credential v1',
    version: '1.0',
    schemaId: 'M6M4nâ€¦:2:PersonCredential:1.0',
    credDefId: 'M6M4nâ€¦:3:CL:67890:tag',
    issuerDid: 'did:sov:M6M4nâ€¦',
    schemaUrl: 'https://bcgov.github.io/digital-trust-toolkit/docs/governance/person/person-cred-doc/',
    attributes: [
      { name: 'given_names' },
      { name: 'family_name' },
      { name: 'birth_date' },
      { name: 'person_identifier' }
    ]
  }
]);
console.log('âœ… Seeded credential library');
```

> **NOTE:** Replace `schemaId` / `credDefId` with the exact values from the CANDY block explorer if known; otherwise leave TODOs â€” Ghostwriter should stub them.

Add to `package.json`:

```json
"scripts": {
  "seed:creds": "ts-node backend/src/seedCredentials.ts"
}
```

Ghostwriter should call this script once during the initial `npm run dev` (use `postinstall` hook) or document manual run in the README.

---

## 6Â Â·Â Dependency Bump

```bash
# frontend
npm i react-hook-form zod @hookform/resolvers
# backend
npm i zod
```

---

## 7Â Â·Â VC Proof Flow Touchâ€‘up

When a component has `dataSource == 'vc'`, gather distinct `templateId`s for the form **on load** and build a combined proof request.  Use `schemaId` & `credDefId` from the library doc.

Backend endpoint `/api/proofs/send` now accepts:

```ts
{
  templates: Array<{ templateId: string, attributes: string[] }>
}
```

and translates into the Digital Credential APIâ€™s proofâ€‘request format.

---

## 8Â Â·Â README Updates

* How to access `/credentials`.
* How to add new templates.
* Mention preâ€‘seeded BC credentials.

---

## 9Â Â·Â Dev Script Update (recap)

```json
"dev": "concurrently "npm --prefix frontend run dev" "npm --prefix backend run dev""
```

(no Form.io server process â€” SDK only)

---

> **Ghostwriter**, generate / modify all files accordingly, ensuring:  
> * All new code is in TypeScript.<br/>
> * Seed script exists.<br/>
> * Builderâ€™s edit form includes credentialÂ â†’Â attribute mapping powered by `/api/cred-lib`.<br/>
> * UI uses Tailwind classes already present in the project.<br/>
> * Leave `TODO` comments where exact schema / credDef IDs are missing.

