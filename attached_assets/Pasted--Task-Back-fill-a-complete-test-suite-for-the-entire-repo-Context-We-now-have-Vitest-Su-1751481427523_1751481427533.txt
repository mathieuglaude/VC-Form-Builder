### ðŸ§ª  Task: Back-fill a complete test suite for the entire repo

Context
â–ª We now have Vitest + Supertest + Husky pre-push gates (see tests/ directory).
â–ª Coverage is very low: most services, hooks, and routes still lack tests.
â–ª Goal: â‰¥ 80 % statement coverage, green CI, push gate enforced.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0 â–¸ Inventory & gap-analysis
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Recursively scan `apps/` and `packages/` for:
     â€“ .ts/.tsx files exporting functions, classes, hooks, Express routes.
2. Build a table:
     {file, exported symbol, alreadyTested? (true|false)}.
3. Print the table to console for visibility.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 â–¸ Auto-generate missing tests  (unit)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
For every {file, symbol} with alreadyTested==false **and**
   located in `src/services`, `src/utils`, `src/hooks`
   â–¸ Create `<symbol>.test.ts` under `tests/unit/â€¦`
   â–¸ Use Vitestâ€™s happy-path + one obvious failure path.
   â–¸ Mock external I/O (fetch, db, Orbit API).
   â–¸ Snapshot critical outputs (e.g., generated payloads).

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2 â–¸ Auto-generate missing tests  (API/e2e)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
For each Express route in `apps/api/routes/**`
   â–¸ If no matching `tests/e2e/<routeName>.e2e.ts`
   â–¸ Create it with Supertest:
       â€“ Success 2xx
       â€“ Expected 4xx path
   â–¸ Use in-memory sqlite or mocked Prisma so tests are hermetic.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3 â–¸ Coverage enforcement
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–ª Add to vitest.config.ts

      coverage: {
        reporter: ['text','lcov'],
        statements: 80,
        branches: 75,
        functions: 80,
        lines: 80
      }

â–ª Update `package.json` script:

      "test": "vitest run --coverage",

â–ª Keep Husky pre-push hook (`pnpm prepush`) unchanged
  â†’ push fails if coverage < threshold.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4 â–¸ Fixtures & helpers
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–ª Re-use / create JSON fixtures in `tests/fixtures/`.
â–ª Add `tests/helpers/mockOrbit.ts` that stubs Orbit calls
  (defineProof, proofUrl) with predictable responses.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5 â–¸ Commit structure
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–ª Make one commit titled â€œtest: back-fill unit + e2e suites, enforce 80 % covâ€.
â–ª Do **NOT** touch production code except:
     â€“ add export hooks if missing
     â€“ expose route handlers for Supertest via `export const app = â€¦`
â–ª Run `pnpm test` locally; ensure green.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6 â–¸ Success criteria
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. `pnpm test` prints global coverage â‰¥ 80 %.
2. `git push` passes Husky gate **only if** all tests pass.
3. GitHub-Actions CI runs and stays green.

###  Deliverables
â–ª New/updated files under tests/.
â–ª Updated vitest.config.ts, package.json if needed.
â–ª Console output showing gap table + final coverage summary.
How to use
Copy the entire block (from to).

Paste it as a single message to your Replit AI pair-programmer.

Wait: it will scan, generate, and commit the missing suites.

Once done, run pnpm test locally; inspect coverage.

Push âžœ Husky + CI will ensure future changes always add / maintain tests.

This enforces the â€œevery new change must ship with tests and never break old onesâ€ principle you wanted, while cleaning historical gaps in one sweep.